<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Substrait is a new specification and set of tools that allow different systems to express clear data manipulation operations."><link href=https://substrait.io/relations/logical_relations/ rel=canonical><link href=../common_fields/ rel=prev><link href=../physical_relations/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.8"><title>Logical Relations - Substrait: Cross-Language Serialization for Relational Algebra</title><link rel=stylesheet href=../../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-57ZX8S93Q5"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-57ZX8S93Q5",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-57ZX8S93Q5",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=pink data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#logical-relations class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Substrait: Cross-Language Serialization for Relational Algebra" class="md-header__button md-logo" aria-label="Substrait: Cross-Language Serialization for Relational Algebra" data-md-component=logo> <img src=../../img/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Substrait: Cross-Language Serialization for Relational Algebra </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Logical Relations </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/substrait-io/substrait title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../spec/versioning/ class=md-tabs__link> Spec </a> </li> <li class=md-tabs__item> <a href=../../types/type_system/ class=md-tabs__link> Types </a> </li> <li class=md-tabs__item> <a href=../../expressions/field_references/ class=md-tabs__link> Expressions </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../basics/ class=md-tabs__link> Relations </a> </li> <li class=md-tabs__item> <a href=../../serialization/basics/ class=md-tabs__link> Serialization </a> </li> <li class=md-tabs__item> <a href=../../extensions/ class=md-tabs__link> Extensions </a> </li> <li class=md-tabs__item> <a href=../../community/ class=md-tabs__link> Community </a> </li> <li class=md-tabs__item> <a href=../../governance/ class=md-tabs__link> Governance </a> </li> <li class=md-tabs__item> <a href=../../about/ class=md-tabs__link> About Substrait </a> </li> <li class=md-tabs__item> <a href=../../tools/producer_tools/ class=md-tabs__link> Tools </a> </li> <li class=md-tabs__item> <a href=../../tutorial/examples/ class=md-tabs__link> Tutorial </a> </li> <li class=md-tabs__item> <a href=../../faq/ class=md-tabs__link> FAQ </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Substrait: Cross-Language Serialization for Relational Algebra" class="md-nav__button md-logo" aria-label="Substrait: Cross-Language Serialization for Relational Algebra" data-md-component=logo> <img src=../../img/logo.svg alt=logo> </a> Substrait: Cross-Language Serialization for Relational Algebra </label> <div class=md-nav__source> <a href=https://github.com/substrait-io/substrait title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Spec </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Spec </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../spec/versioning/ class=md-nav__link> <span class=md-ellipsis> Versioning </span> </a> </li> <li class=md-nav__item> <a href=../../spec/specification/ class=md-nav__link> <span class=md-ellipsis> Specification </span> </a> </li> <li class=md-nav__item> <a href=../../spec/technology_principles/ class=md-nav__link> <span class=md-ellipsis> Technology Principles </span> </a> </li> <li class=md-nav__item> <a href=../../spec/extending/ class=md-nav__link> <span class=md-ellipsis> Extending </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Types </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Types </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../types/type_system/ class=md-nav__link> <span class=md-ellipsis> Type System </span> </a> </li> <li class=md-nav__item> <a href=../../types/type_classes/ class=md-nav__link> <span class=md-ellipsis> Type Classes </span> </a> </li> <li class=md-nav__item> <a href=../../types/type_variations/ class=md-nav__link> <span class=md-ellipsis> Type Variations </span> </a> </li> <li class=md-nav__item> <a href=../../types/type_parsing/ class=md-nav__link> <span class=md-ellipsis> Type Syntax Parsing </span> </a> </li> <li class=md-nav__item> <a href=../../types/named_structs/ class=md-nav__link> <span class=md-ellipsis> Named Structs </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Expressions </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Expressions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../expressions/field_references/ class=md-nav__link> <span class=md-ellipsis> Field References </span> </a> </li> <li class=md-nav__item> <a href=../../expressions/scalar_functions/ class=md-nav__link> <span class=md-ellipsis> Scalar Functions </span> </a> </li> <li class=md-nav__item> <a href=../../expressions/aggregate_functions/ class=md-nav__link> <span class=md-ellipsis> Aggregate Functions </span> </a> </li> <li class=md-nav__item> <a href=../../expressions/specialized_record_expressions/ class=md-nav__link> <span class=md-ellipsis> Specialized Record Expressions </span> </a> </li> <li class=md-nav__item> <a href=../../expressions/window_functions/ class=md-nav__link> <span class=md-ellipsis> Window Functions </span> </a> </li> <li class=md-nav__item> <a href=../../expressions/table_functions/ class=md-nav__link> <span class=md-ellipsis> Table Functions </span> </a> </li> <li class=md-nav__item> <a href=../../expressions/user_defined_functions/ class=md-nav__link> <span class=md-ellipsis> User-Defined Functions </span> </a> </li> <li class=md-nav__item> <a href=../../expressions/embedded_functions/ class=md-nav__link> <span class=md-ellipsis> Embedded Functions </span> </a> </li> <li class=md-nav__item> <a href=../../expressions/dynamic_parameters/ class=md-nav__link> <span class=md-ellipsis> Dynamic Parameter Expression </span> </a> </li> <li class=md-nav__item> <a href=../../expressions/extended_expression/ class=md-nav__link> <span class=md-ellipsis> Extended Expression </span> </a> </li> <li class=md-nav__item> <a href=../../expressions/subqueries/ class=md-nav__link> <span class=md-ellipsis> Subqueries </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Relations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Relations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../basics/ class=md-nav__link> <span class=md-ellipsis> Basics </span> </a> </li> <li class=md-nav__item> <a href=../common_fields/ class=md-nav__link> <span class=md-ellipsis> Common Fields </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Logical Relations </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Logical Relations </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#read-operator class=md-nav__link> <span class=md-ellipsis> Read Operator </span> </a> <nav class=md-nav aria-label="Read Operator"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#read-properties class=md-nav__link> <span class=md-ellipsis> Read Properties </span> </a> </li> <li class=md-nav__item> <a href=#read-filtering class=md-nav__link> <span class=md-ellipsis> Read Filtering </span> </a> </li> <li class=md-nav__item> <a href=#read-definition-types class=md-nav__link> <span class=md-ellipsis> Read Definition Types </span> </a> <nav class=md-nav aria-label="Read Definition Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#virtual-table class=md-nav__link> <span class=md-ellipsis> Virtual Table </span> </a> </li> <li class=md-nav__item> <a href=#named-table class=md-nav__link> <span class=md-ellipsis> Named Table </span> </a> </li> <li class=md-nav__item> <a href=#files-type class=md-nav__link> <span class=md-ellipsis> Files Type </span> </a> <nav class=md-nav aria-label="Files Type"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#slicing-files class=md-nav__link> <span class=md-ellipsis> Slicing Files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#iceberg-table-type class=md-nav__link> <span class=md-ellipsis> Iceberg Table Type </span> </a> <nav class=md-nav aria-label="Iceberg Table Type"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#metadata-file-reading class=md-nav__link> <span class=md-ellipsis> Metadata File Reading </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#filter-operation class=md-nav__link> <span class=md-ellipsis> Filter Operation </span> </a> <nav class=md-nav aria-label="Filter Operation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#filter-properties class=md-nav__link> <span class=md-ellipsis> Filter Properties </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sort-operation class=md-nav__link> <span class=md-ellipsis> Sort Operation </span> </a> <nav class=md-nav aria-label="Sort Operation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#sort-properties class=md-nav__link> <span class=md-ellipsis> Sort Properties </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#project-operation class=md-nav__link> <span class=md-ellipsis> Project Operation </span> </a> <nav class=md-nav aria-label="Project Operation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#project-properties class=md-nav__link> <span class=md-ellipsis> Project Properties </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cross-product-operation class=md-nav__link> <span class=md-ellipsis> Cross Product Operation </span> </a> <nav class=md-nav aria-label="Cross Product Operation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cross-product-properties class=md-nav__link> <span class=md-ellipsis> Cross Product Properties </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#join-operation class=md-nav__link> <span class=md-ellipsis> Join Operation </span> </a> <nav class=md-nav aria-label="Join Operation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#join-properties class=md-nav__link> <span class=md-ellipsis> Join Properties </span> </a> </li> <li class=md-nav__item> <a href=#join-types class=md-nav__link> <span class=md-ellipsis> Join Types </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#set-operation class=md-nav__link> <span class=md-ellipsis> Set Operation </span> </a> <nav class=md-nav aria-label="Set Operation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#set-properties class=md-nav__link> <span class=md-ellipsis> Set Properties </span> </a> </li> <li class=md-nav__item> <a href=#set-operation-types class=md-nav__link> <span class=md-ellipsis> Set Operation Types </span> </a> <nav class=md-nav aria-label="Set Operation Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#output-type-derivation-examples class=md-nav__link> <span class=md-ellipsis> Output Type Derivation Examples </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fetch-operation class=md-nav__link> <span class=md-ellipsis> Fetch Operation </span> </a> <nav class=md-nav aria-label="Fetch Operation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fetch-properties class=md-nav__link> <span class=md-ellipsis> Fetch Properties </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aggregate-operation class=md-nav__link> <span class=md-ellipsis> Aggregate Operation </span> </a> <nav class=md-nav aria-label="Aggregate Operation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aggregate-properties class=md-nav__link> <span class=md-ellipsis> Aggregate Properties </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reference-operator class=md-nav__link> <span class=md-ellipsis> Reference Operator </span> </a> <nav class=md-nav aria-label="Reference Operator"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#reference-properties class=md-nav__link> <span class=md-ellipsis> Reference Properties </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#write-operator class=md-nav__link> <span class=md-ellipsis> Write Operator </span> </a> <nav class=md-nav aria-label="Write Operator"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#write-properties class=md-nav__link> <span class=md-ellipsis> Write Properties </span> </a> </li> <li class=md-nav__item> <a href=#write-definition-types class=md-nav__link> <span class=md-ellipsis> Write Definition Types </span> </a> <nav class=md-nav aria-label="Write Definition Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#virtual-table_1 class=md-nav__link> <span class=md-ellipsis> Virtual Table </span> </a> </li> <li class=md-nav__item> <a href=#files-type_1 class=md-nav__link> <span class=md-ellipsis> Files Type </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#update-operator class=md-nav__link> <span class=md-ellipsis> Update Operator </span> </a> <nav class=md-nav aria-label="Update Operator"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#update-properties class=md-nav__link> <span class=md-ellipsis> Update Properties </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ddl-data-definition-language-operator class=md-nav__link> <span class=md-ellipsis> DDL (Data Definition Language) Operator </span> </a> <nav class=md-nav aria-label="DDL (Data Definition Language) Operator"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ddl-properties class=md-nav__link> <span class=md-ellipsis> DDL Properties </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../physical_relations/ class=md-nav__link> <span class=md-ellipsis> Physical Relations </span> </a> </li> <li class=md-nav__item> <a href=../user_defined_relations/ class=md-nav__link> <span class=md-ellipsis> User Defined Relations </span> </a> </li> <li class=md-nav__item> <a href=../embedded_relations/ class=md-nav__link> <span class=md-ellipsis> Embedded Relations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Serialization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Serialization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serialization/basics/ class=md-nav__link> <span class=md-ellipsis> Basics </span> </a> </li> <li class=md-nav__item> <a href=../../serialization/binary_serialization/ class=md-nav__link> <span class=md-ellipsis> Binary Serialization </span> </a> </li> <li class=md-nav__item> <a href=../../serialization/text_serialization/ class=md-nav__link> <span class=md-ellipsis> Text Serialization </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Extensions </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Extensions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../extensions/ class=md-nav__link> <span class=md-ellipsis> Extensions </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_aggregate_approx/ class=md-nav__link> <span class=md-ellipsis> functions_aggregate_approx.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_aggregate_decimal_output/ class=md-nav__link> <span class=md-ellipsis> functions_aggregate_decimal_output.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_aggregate_generic/ class=md-nav__link> <span class=md-ellipsis> functions_aggregate_generic.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_arithmetic/ class=md-nav__link> <span class=md-ellipsis> functions_arithmetic.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_arithmetic_decimal/ class=md-nav__link> <span class=md-ellipsis> functions_arithmetic_decimal.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_boolean/ class=md-nav__link> <span class=md-ellipsis> functions_boolean.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_comparison/ class=md-nav__link> <span class=md-ellipsis> functions_comparison.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_datetime/ class=md-nav__link> <span class=md-ellipsis> functions_datetime.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_geometry/ class=md-nav__link> <span class=md-ellipsis> functions_geometry.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_logarithmic/ class=md-nav__link> <span class=md-ellipsis> functions_logarithmic.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_rounding/ class=md-nav__link> <span class=md-ellipsis> functions_rounding.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_rounding_decimal/ class=md-nav__link> <span class=md-ellipsis> functions_rounding_decimal.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_set/ class=md-nav__link> <span class=md-ellipsis> functions_set.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../extensions/functions_string/ class=md-nav__link> <span class=md-ellipsis> functions_string.yaml </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Community </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Community </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../community/ class=md-nav__link> <span class=md-ellipsis> Community </span> </a> </li> <li class=md-nav__item> <a href=../../community/powered_by/ class=md-nav__link> <span class=md-ellipsis> Powered by Substrait </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../governance/ class=md-nav__link> <span class=md-ellipsis> Governance </span> </a> </li> <li class=md-nav__item> <a href=../../about/ class=md-nav__link> <span class=md-ellipsis> About Substrait </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools/producer_tools/ class=md-nav__link> <span class=md-ellipsis> Producer Tools </span> </a> </li> <li class=md-nav__item> <a href=../../tools/substrait_validator/ class=md-nav__link> <span class=md-ellipsis> Substrait Validator </span> </a> </li> <li class=md-nav__item> <a href=../../tools/third_party_tools/ class=md-nav__link> <span class=md-ellipsis> Third Party Tools </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0> <span class=md-ellipsis> Tutorial </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Tutorial </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tutorial/examples/ class=md-nav__link> <span class=md-ellipsis> Code samples and examples </span> </a> </li> <li class=md-nav__item> <a href=../../tutorial/sql_to_substrait/ class=md-nav__link> <span class=md-ellipsis> SQL to Substrait tutorial </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=logical-relations>Logical Relations<a class=headerlink href=#logical-relations title="Permanent link">&para;</a></h1> <h2 id=read-operator>Read Operator<a class=headerlink href=#read-operator title="Permanent link">&para;</a></h2> <p>The read operator is an operator that produces one output. A simple example would be the reading of a Parquet file. It is expected that many types of reads will be added over time.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>0</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>N/A (no inputs)</td> </tr> <tr> <td>Direct Output Order</td> <td>Defaults to the schema of the data read after the optional projection (masked complex expression) is applied.</td> </tr> </tbody> </table> <h3 id=read-properties>Read Properties<a class=headerlink href=#read-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Definition</td> <td>The contents of the read property definition.</td> <td>Required</td> </tr> <tr> <td>Direct Schema</td> <td>Defines the schema of the output of the read (before any projection or emit remapping/hiding).</td> <td>Required</td> </tr> <tr> <td>Filter</td> <td>A boolean Substrait expression that describes a filter that must be applied to the data. The filter should be interpreted against the direct schema.</td> <td>Optional, defaults to none.</td> </tr> <tr> <td>Best Effort Filter</td> <td>A boolean Substrait expression that describes a filter that may be applied to the data. The filter should be interpreted against the direct schema.</td> <td>Optional, defaults to none.</td> </tr> <tr> <td>Projection</td> <td>A masked complex expression describing the portions of the content that should be read</td> <td>Optional, defaults to all of schema</td> </tr> <tr> <td>Output Properties</td> <td>Declaration of orderedness and/or distribution properties this read produces.</td> <td>Optional, defaults to no properties.</td> </tr> <tr> <td>Properties</td> <td>A list of name/value pairs associated with the read.</td> <td>Optional, defaults to empty</td> </tr> </tbody> </table> <h3 id=read-filtering>Read Filtering<a class=headerlink href=#read-filtering title="Permanent link">&para;</a></h3> <p>The read relation has two different filter properties. A filter, which must be satisfied by the operator and a best effort filter, which does not have to be satisfied. This reflects the way that consumers are often implemented. A consumer is often only able to fully apply a limited set of operations in the scan. There can then be an extended set of operations which a consumer can apply in a best effort fashion. A producer, when setting these two fields, should take care to only use expressions that the consumer is capable of handling.</p> <p>As an example, a consumer may only be able to fully apply (in the read relation) &lt;, =, and &gt; on integral types. The consumer may be able to apply &lt;, =, and &gt; in a best effort fashion on decimal and string types. Consider the filter expression <code>my_int &lt; 10 &amp;&amp; my_string &lt; "x" &amp;&amp; upper(my_string) &gt; "B"</code>. In this case the <code>filter</code> should be set to <code>my_int &lt; 10</code> and the <code>best_effort_filter</code> should be set to <code>my_string &lt; "x"</code> and the remaining portion (<code>upper(my_string) &gt; "B"</code>) should be put into a filter relation.</p> <p>A filter expression must be interpreted against the direct schema before the projection expression has been applied. As a result, fields may be referenced by the filter expression which are not included in the relation&rsquo;s output.</p> <h3 id=read-definition-types>Read Definition Types<a class=headerlink href=#read-definition-types title="Permanent link">&para;</a></h3> <details class="info inline end" open=open> <summary>Adding new Read Definition Types</summary> <p>If you have a read definition that&rsquo;s not covered here, see the <a href=../../spec/extending/ >process for adding new read definition types</a>.</p> </details> <p>Read definition types (like the rest of the features in Substrait) are built by the community and added to the specification.</p> <h4 id=virtual-table>Virtual Table<a class=headerlink href=#virtual-table title="Permanent link">&para;</a></h4> <p>A virtual table is a table whose contents are embedded in the plan itself. The table data is encoded as records consisting of literal values or expressions that can be resolved without referencing any input data. For example, a literal, a function call involving literals, or any other expression that does not require input.</p> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Data</td> <td>Required</td> <td>Required</td> </tr> </tbody> </table> <h4 id=named-table>Named Table<a class=headerlink href=#named-table title="Permanent link">&para;</a></h4> <p>A named table is a reference to data defined elsewhere. For example, there may be a catalog of tables with unique names that both the producer and consumer agree on. This catalog would provide the consumer with more information on how to retrieve the data.</p> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Names</td> <td>A list of namespaced strings that, together, form the table name</td> <td>Required (at least one)</td> </tr> </tbody> </table> <h4 id=files-type>Files Type<a class=headerlink href=#files-type title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Items</td> <td>An array of Items (path or path glob) associated with the read.</td> <td>Required</td> </tr> <tr> <td>Format per item</td> <td>Enumeration of available formats. Only current option is PARQUET.</td> <td>Required</td> </tr> <tr> <td>Slicing parameters per item</td> <td>Information to use when reading a slice of a file.</td> <td>Optional</td> </tr> </tbody> </table> <h5 id=slicing-files>Slicing Files<a class=headerlink href=#slicing-files title="Permanent link">&para;</a></h5> <p>A read operation is allowed to only read part of a file. This is convenient, for example, when distributing a read operation across several nodes. The slicing parameters are specified as byte offsets into the file.</p> <p>Many file formats consist of indivisible &ldquo;chunks&rdquo; of data (e.g. Parquet row groups). If this happens the consumer can determine which slice a particular chunk belongs to. For example, one possible approach is that a chunk should only be read if the midpoint of the chunk (dividing by 2 and rounding down) is contained within the asked-for byte range.</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:1><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>ReadRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>ReadRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>  </span><span class=n>NamedStruct</span><span class=w> </span><span class=na>base_schema</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=n>Expression</span><span class=w> </span><span class=na>filter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>  </span><span class=n>Expression</span><span class=w> </span><span class=na>best_effort_filter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>11</span><span class=p>;</span>
<span class=w>  </span><span class=n>Expression.MaskExpression</span><span class=w> </span><span class=na>projection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>
<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// Definition of which type of scan operation is to be performed</span>
<span class=w>  </span><span class=k>oneof</span><span class=w> </span><span class=n>read_type</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>VirtualTable</span><span class=w> </span><span class=na>virtual_table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>
<span class=w>    </span><span class=n>LocalFiles</span><span class=w> </span><span class=na>local_files</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>6</span><span class=p>;</span>
<span class=w>    </span><span class=n>NamedTable</span><span class=w> </span><span class=na>named_table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>7</span><span class=p>;</span>
<span class=w>    </span><span class=n>ExtensionTable</span><span class=w> </span><span class=na>extension_table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>8</span><span class=p>;</span>
<span class=w>    </span><span class=n>IcebergTable</span><span class=w> </span><span class=na>iceberg_table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>9</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// A base table. The list of string is used to represent namespacing (e.g., mydb.mytable).</span>
<span class=w>  </span><span class=c1>// This assumes shared catalog between systems exchanging a message.</span>
<span class=w>  </span><span class=kd>message</span><span class=w> </span><span class=nc>NamedTable</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>repeated</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=na>names</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// Read an Iceberg Table</span>
<span class=w>  </span><span class=kd>message</span><span class=w> </span><span class=nc>IcebergTable</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>oneof</span><span class=w> </span><span class=n>table_type</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=n>MetadataFileRead</span><span class=w> </span><span class=na>direct</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>      </span><span class=c1>// future: add catalog table types (e.g. rest api, latest metadata in path, etc)</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=c1>// Read an Iceberg table using a metadata file. Implicit assumption: required credentials are already known by plan consumer.</span>
<span class=w>    </span><span class=kd>message</span><span class=w> </span><span class=nc>MetadataFileRead</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=c1>// the specific uri of a metadata file (e.g. s3://mybucket/mytable/&lt;ver&gt;-&lt;uuid&gt;.metadata.json)</span>
<span class=w>      </span><span class=kt>string</span><span class=w> </span><span class=na>metadata_uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>

<span class=w>      </span><span class=c1>// snapshot options. if none set, uses the current snapshot listed in the metadata file</span>
<span class=w>      </span><span class=k>oneof</span><span class=w> </span><span class=n>snapshot</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// the snapshot id to read.</span>
<span class=w>        </span><span class=kt>string</span><span class=w> </span><span class=na>snapshot_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>

<span class=w>        </span><span class=c1>// the timestamp that should be used to select the snapshot (Time passed in microseconds since 1970-01-01 00:00:00.000000 in UTC)</span>
<span class=w>        </span><span class=kt>int64</span><span class=w> </span><span class=na>snapshot_timestamp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// A table composed of expressions.</span>
<span class=w>  </span><span class=kd>message</span><span class=w> </span><span class=nc>VirtualTable</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>repeated</span><span class=w> </span><span class=n>Expression.Literal.Struct</span><span class=w> </span><span class=na>values</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>[</span><span class=na>deprecated</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>];</span>
<span class=w>    </span><span class=k>repeated</span><span class=w> </span><span class=n>Expression.Nested.Struct</span><span class=w> </span><span class=na>expressions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// A stub type that can be used to extend/introduce new table types outside</span>
<span class=w>  </span><span class=c1>// the specification.</span>
<span class=w>  </span><span class=kd>message</span><span class=w> </span><span class=nc>ExtensionTable</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>google.protobuf.Any</span><span class=w> </span><span class=na>detail</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// Represents a list of files in input of a scan operation</span>
<span class=w>  </span><span class=kd>message</span><span class=w> </span><span class=nc>LocalFiles</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>repeated</span><span class=w> </span><span class=n>FileOrFiles</span><span class=w> </span><span class=na>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>

<span class=w>    </span><span class=c1>// Many files consist of indivisible chunks (e.g. parquet row groups</span>
<span class=w>    </span><span class=c1>// or CSV rows).  If a slice partially selects an indivisible chunk</span>
<span class=w>    </span><span class=c1>// then the consumer should employ some rule to decide which slice to</span>
<span class=w>    </span><span class=c1>// include the chunk in (e.g. include it in the slice that contains</span>
<span class=w>    </span><span class=c1>// the midpoint of the chunk)</span>
<span class=w>    </span><span class=kd>message</span><span class=w> </span><span class=nc>FileOrFiles</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>oneof</span><span class=w> </span><span class=n>path_type</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// A URI that can refer to either a single folder or a single file</span>
<span class=w>        </span><span class=kt>string</span><span class=w> </span><span class=na>uri_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>        </span><span class=c1>// A URI where the path portion is a glob expression that can</span>
<span class=w>        </span><span class=c1>// identify zero or more paths.</span>
<span class=w>        </span><span class=c1>// Consumers should support the POSIX syntax.  The recursive</span>
<span class=w>        </span><span class=c1>// globstar (**) may not be supported.</span>
<span class=w>        </span><span class=kt>string</span><span class=w> </span><span class=na>uri_path_glob</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>        </span><span class=c1>// A URI that refers to a single file</span>
<span class=w>        </span><span class=kt>string</span><span class=w> </span><span class=na>uri_file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>        </span><span class=c1>// A URI that refers to a single folder</span>
<span class=w>        </span><span class=kt>string</span><span class=w> </span><span class=na>uri_folder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>

<span class=w>      </span><span class=c1>// Original file format enum, superseded by the file_format oneof.</span>
<span class=w>      </span><span class=k>reserved</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>
<span class=w>      </span><span class=k>reserved</span><span class=w> </span><span class=s>&quot;format&quot;</span><span class=p>;</span>

<span class=w>      </span><span class=c1>// The index of the partition this item belongs to</span>
<span class=w>      </span><span class=kt>uint64</span><span class=w> </span><span class=na>partition_index</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>6</span><span class=p>;</span>

<span class=w>      </span><span class=c1>// The start position in byte to read from this item</span>
<span class=w>      </span><span class=kt>uint64</span><span class=w> </span><span class=na>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>7</span><span class=p>;</span>

<span class=w>      </span><span class=c1>// The length in byte to read from this item</span>
<span class=w>      </span><span class=kt>uint64</span><span class=w> </span><span class=na>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>8</span><span class=p>;</span>

<span class=w>      </span><span class=kd>message</span><span class=w> </span><span class=nc>ParquetReadOptions</span><span class=w> </span><span class=p>{}</span>
<span class=w>      </span><span class=kd>message</span><span class=w> </span><span class=nc>ArrowReadOptions</span><span class=w> </span><span class=p>{}</span>
<span class=w>      </span><span class=kd>message</span><span class=w> </span><span class=nc>OrcReadOptions</span><span class=w> </span><span class=p>{}</span>
<span class=w>      </span><span class=kd>message</span><span class=w> </span><span class=nc>DwrfReadOptions</span><span class=w> </span><span class=p>{}</span>
<span class=w>      </span><span class=kd>message</span><span class=w> </span><span class=nc>DelimiterSeparatedTextReadOptions</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// Delimiter separated files may be compressed.  The reader should</span>
<span class=w>        </span><span class=c1>// autodetect this and decompress as needed.</span>

<span class=w>        </span><span class=c1>// The character(s) used to separate fields.  Common values are comma,</span>
<span class=w>        </span><span class=c1>// tab, and pipe.  Multiple characters are allowed.</span>
<span class=w>        </span><span class=kt>string</span><span class=w> </span><span class=na>field_delimiter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>        </span><span class=c1>// The maximum number of bytes to read from a single line.  If a line</span>
<span class=w>        </span><span class=c1>// exceeds this limit the resulting behavior is undefined.</span>
<span class=w>        </span><span class=kt>uint64</span><span class=w> </span><span class=na>max_line_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>        </span><span class=c1>// The character(s) used to quote strings.  Common values are single</span>
<span class=w>        </span><span class=c1>// and double quotation marks.</span>
<span class=w>        </span><span class=kt>string</span><span class=w> </span><span class=na>quote</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>        </span><span class=c1>// The number of lines to skip at the beginning of the file.</span>
<span class=w>        </span><span class=kt>uint64</span><span class=w> </span><span class=na>header_lines_to_skip</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>
<span class=w>        </span><span class=c1>// The character used to escape characters in strings.  Backslash is</span>
<span class=w>        </span><span class=c1>// a common value.  Note that a double quote mark can also be used as an</span>
<span class=w>        </span><span class=c1>// escape character but the external quotes should be removed first.</span>
<span class=w>        </span><span class=kt>string</span><span class=w> </span><span class=na>escape</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>
<span class=w>        </span><span class=c1>// If this value is encountered (including empty string), the resulting</span>
<span class=w>        </span><span class=c1>// value is null instead.  Leave unset to disable.  If this value is</span>
<span class=w>        </span><span class=c1>// provided, the effective schema of this file is comprised entirely of</span>
<span class=w>        </span><span class=c1>// nullable strings.  If not provided, the effective schema is instead</span>
<span class=w>        </span><span class=c1>// made up of non-nullable strings.</span>
<span class=w>        </span><span class=k>optional</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=na>value_treated_as_null</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>6</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>

<span class=w>      </span><span class=c1>// The format of the files along with options for reading those files.</span>
<span class=w>      </span><span class=k>oneof</span><span class=w> </span><span class=n>file_format</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>ParquetReadOptions</span><span class=w> </span><span class=na>parquet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>9</span><span class=p>;</span>
<span class=w>        </span><span class=n>ArrowReadOptions</span><span class=w> </span><span class=na>arrow</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>
<span class=w>        </span><span class=n>OrcReadOptions</span><span class=w> </span><span class=na>orc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>11</span><span class=p>;</span>
<span class=w>        </span><span class=n>google.protobuf.Any</span><span class=w> </span><span class=na>extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>12</span><span class=p>;</span>
<span class=w>        </span><span class=n>DwrfReadOptions</span><span class=w> </span><span class=na>dwrf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>13</span><span class=p>;</span>
<span class=w>        </span><span class=n>DelimiterSeparatedTextReadOptions</span><span class=w> </span><span class=na>text</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>14</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h4 id=iceberg-table-type>Iceberg Table Type<a class=headerlink href=#iceberg-table-type title="Permanent link">&para;</a></h4> <p>A Iceberg Table is a table built on <a href=https://iceberg.apache.org/ >Apache Iceberg</a>. Iceberg tables can be read by either directly reading a <a href=https://iceberg.apache.org/spec/#table-metadata>metadata file</a> or by consulting a <a href=https://iceberg.apache.org/concepts/catalog/ >catalog</a>. </p> <h5 id=metadata-file-reading>Metadata File Reading<a class=headerlink href=#metadata-file-reading title="Permanent link">&para;</a></h5> <p>Points to an <a href=https://iceberg.apache.org/spec/#table-metadata>Iceberg metadata file</a> and uses that as a starting point for reading an Iceberg table. This is the simplest form of Iceberg table access but should be limited to use for reads. (Writes often also need to update an external catalog.)</p> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>metadata_uri</td> <td>A URI for an Iceberg metadata file. This current snapshot will be read from this file.</td> <td>Required</td> </tr> <tr> <td>snapshot_id</td> <td>The snapshot that should be read using id. If not provided, the current snapshot is read. Only one of snapshot_id or snapshot_timestamp should be set.</td> <td>Optional</td> </tr> <tr> <td>snapshot_timestamp</td> <td>The snapshot that should be read using timestamp. If not provided, the current snapshot is read.</td> <td>Optional</td> </tr> </tbody> </table> <h2 id=filter-operation>Filter Operation<a class=headerlink href=#filter-operation title="Permanent link">&para;</a></h2> <p>The filter operator eliminates one or more records from the input data based on a boolean filter expression.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>1</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Orderedness, Distribution, remapped by emit</td> </tr> <tr> <td>Direct Output Order</td> <td>The field order as the input.</td> </tr> </tbody> </table> <h3 id=filter-properties>Filter Properties<a class=headerlink href=#filter-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Input</td> <td>The relational input.</td> <td>Required</td> </tr> <tr> <td>Expression</td> <td>A boolean expression which describes which records are included/excluded.</td> <td>Required</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=2:1><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>FilterRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>FilterRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=n>Expression</span><span class=w> </span><span class=na>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h2 id=sort-operation>Sort Operation<a class=headerlink href=#sort-operation title="Permanent link">&para;</a></h2> <p>The sort operator reorders a dataset based on one or more identified sort fields and a sorting function for each.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>1</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Will update orderedness property to the output of the sort operation. Distribution property only remapped based on emit.</td> </tr> <tr> <td>Direct Output Order</td> <td>The field order of the input.</td> </tr> </tbody> </table> <h3 id=sort-properties>Sort Properties<a class=headerlink href=#sort-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Input</td> <td>The relational input.</td> <td>Required</td> </tr> <tr> <td>Sort Fields</td> <td>List of one or more fields to sort by. Uses the same properties as the <a href=../basics/#orderedness>orderedness</a> property.</td> <td>One sort field required</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>SortRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>SortRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=k>repeated</span><span class=w> </span><span class=n>SortField</span><span class=w> </span><span class=na>sorts</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h2 id=project-operation>Project Operation<a class=headerlink href=#project-operation title="Permanent link">&para;</a></h2> <p>The project operation will produce one or more additional expressions based on the inputs of the relation.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>1</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Distribution maintained, mapped by emit. Orderedness: Maintained if no window operations. Extended to include projection fields if fields are direct references. If window operations are present, no orderedness is maintained.</td> </tr> <tr> <td>Direct Output Order</td> <td>The field order of the input + the list of new expressions in the order they are declared in the expressions list.</td> </tr> </tbody> </table> <h3 id=project-properties>Project Properties<a class=headerlink href=#project-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Input</td> <td>The relational input.</td> <td>Required</td> </tr> <tr> <td>Expressions</td> <td>List of one or more expressions to add to the input.</td> <td>At least one expression required</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=4:1><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>ProjectRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>ProjectRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=k>repeated</span><span class=w> </span><span class=n>Expression</span><span class=w> </span><span class=na>expressions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h2 id=cross-product-operation>Cross Product Operation<a class=headerlink href=#cross-product-operation title="Permanent link">&para;</a></h2> <p>The cross product operation will combine two separate inputs into a single output. It pairs every record from the left input with every record of the right input.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>2</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Distribution is maintained. Orderedness is empty post operation.</td> </tr> <tr> <td>Direct Output Order</td> <td>The emit order of the left input followed by the emit order of the right input.</td> </tr> </tbody> </table> <h3 id=cross-product-properties>Cross Product Properties<a class=headerlink href=#cross-product-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Left Input</td> <td>A relational input.</td> <td>Required</td> </tr> <tr> <td>Right Input</td> <td>A relational input.</td> <td>Required</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=5:1><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1>CrossRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>CrossRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>

<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h2 id=join-operation>Join Operation<a class=headerlink href=#join-operation title="Permanent link">&para;</a></h2> <p>The join operation will combine two separate inputs into a single output, based on a join expression. A common subtype of joins is an equality join where the join expression is constrained to a list of equality (or equality + null equality) conditions between the two inputs of the join.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>2</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Distribution is maintained. Orderedness is empty post operation. Physical relations may provide better property maintenance.</td> </tr> <tr> <td>Direct Output Order</td> <td>The emit order of the left input followed by the emit order of the right input.</td> </tr> </tbody> </table> <h3 id=join-properties>Join Properties<a class=headerlink href=#join-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Left Input</td> <td>A relational input.</td> <td>Required</td> </tr> <tr> <td>Right Input</td> <td>A relational input.</td> <td>Required</td> </tr> <tr> <td>Join Expression</td> <td>A boolean condition that describes whether each record from the left set &ldquo;match&rdquo; the record from the right set. Field references correspond to the direct output order of the data.</td> <td>Required. Can be the literal True.</td> </tr> <tr> <td>Post-Join Filter</td> <td>A boolean condition to be applied to each result record after the inputs have been joined, yielding only the records that satisfied the condition.</td> <td>Optional</td> </tr> <tr> <td>Join Type</td> <td>One of the join types defined below.</td> <td>Required</td> </tr> </tbody> </table> <h3 id=join-types>Join Types<a class=headerlink href=#join-types title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>Inner</td> <td>Return records from the left side only if they match the right side. Return records from the right side only when they match the left side. For each cross input match, return a record including the data from both sides. Non-matching records are ignored.</td> </tr> <tr> <td>Outer</td> <td>Return all records from both the left and right inputs. For each cross input match, return a record including the data from both sides. For any remaining non-match records, return the record from the corresponding input along with nulls for the opposite input.</td> </tr> <tr> <td>Left</td> <td>Return all records from the left input. For each cross input match, return a record including the data from both sides. For any remaining non-matching records from the left input, return the left record along with nulls for the right input.</td> </tr> <tr> <td>Right</td> <td>Return all records from the right input. For each cross input match, return a record including the data from both sides. For any remaining non-matching records from the right input, return the right record along with nulls for the left input.</td> </tr> <tr> <td>Left Semi</td> <td>Returns records from the left input. These are returned only if the records have a join partner on the right side.</td> </tr> <tr> <td>Right Semi</td> <td>Returns records from the right input. These are returned only if the records have a join partner on the left side.</td> </tr> <tr> <td>Left Anti</td> <td>Return records from the left input. These are returned only if the records do not have a join partner on the right side.</td> </tr> <tr> <td>Right Anti</td> <td>Return records from the right input. These are returned only if the records do not have a join partner on the left side.</td> </tr> <tr> <td>Left Single</td> <td>Return all records from the left input with no join expansion. If at least one record from the right input matches the left, return one arbitrary matching record from the right input. For any left records without matching right records, return the left record along with nulls for the right input. Similar to a left outer join but only returns one right match at most. Useful for nested sub-queries where we need exactly one record in output (or throw exception). See Section 3.2 of <a href=https://15721.courses.cs.cmu.edu/spring2018/papers/16-optimizer2/hyperjoins-btw2017.pdf>https://15721.courses.cs.cmu.edu/spring2018/papers/16-optimizer2/hyperjoins-btw2017.pdf</a> for more information.</td> </tr> <tr> <td>Right Single</td> <td>Same as left single except that the right and left inputs are switched.</td> </tr> <tr> <td>Left Mark</td> <td>Returns one record for each record from the left input. Appends one additional &ldquo;mark&rdquo; column to the output of the join. The new column will be listed after all columns from both sides and will be of type nullable boolean. If there is at least one join partner in the right input where the join condition evaluates to true then the mark column will be set to true. Otherwise, if there is at least one join partner in the right input where the join condition evaluates to NULL then the mark column will be set to NULL. Otherwise the mark column will be set to false.</td> </tr> <tr> <td>Right Mark</td> <td>Returns records from the right input. Appends one additional &ldquo;mark&rdquo; column to the output of the join. The new column will be listed after all columns from both sides and will be of type nullable boolean. If there is at least one join partner in the left input where the join condition evaluates to true then the mark column will be set to true. Otherwise, if there is at least one join partner in the left input where the join condition evaluates to NULL then the mark column will be set to NULL. Otherwise the mark column will be set to false.</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=6:1><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><div class=tabbed-labels><label for=__tabbed_6_1>JoinRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>JoinRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>  </span><span class=n>Expression</span><span class=w> </span><span class=na>expression</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>
<span class=w>  </span><span class=n>Expression</span><span class=w> </span><span class=na>post_join_filter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>

<span class=w>  </span><span class=n>JoinType</span><span class=w> </span><span class=na>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>6</span><span class=p>;</span>

<span class=w>  </span><span class=kd>enum</span><span class=w> </span><span class=n>JoinType</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=na>JOIN_TYPE_UNSPECIFIED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_INNER</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_OUTER</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_LEFT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_RIGHT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_LEFT_SEMI</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_LEFT_ANTI</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>6</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_LEFT_SINGLE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>7</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_RIGHT_SEMI</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>8</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_RIGHT_ANTI</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>9</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_RIGHT_SINGLE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_LEFT_MARK</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>11</span><span class=p>;</span>
<span class=w>    </span><span class=na>JOIN_TYPE_RIGHT_MARK</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>12</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h2 id=set-operation>Set Operation<a class=headerlink href=#set-operation title="Permanent link">&para;</a></h2> <p>The set operation encompasses several set-level operations that support combining datasets, possibly excluding records based on various types of record level matching.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>2 or more</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Maintains distribution if all inputs have the same ordinal distribution. Orderedness is not maintained.</td> </tr> <tr> <td>Direct Output Order</td> <td>The field order of the inputs. All inputs must have identical field <em>types</em>, but field nullabilities may vary.</td> </tr> </tbody> </table> <h3 id=set-properties>Set Properties<a class=headerlink href=#set-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Primary Input</td> <td>The primary input of the relation.</td> <td>Required</td> </tr> <tr> <td>Secondary Inputs</td> <td>One or more relational inputs.</td> <td>At least one required</td> </tr> <tr> <td>Set Operation Type</td> <td>From list below.</td> <td>Required</td> </tr> </tbody> </table> <h3 id=set-operation-types>Set Operation Types<a class=headerlink href=#set-operation-types title="Permanent link">&para;</a></h3> <p>The set operation type determines both the records that are emitted and the type of the output record.</p> <p>For some set operations, whether a specific record is included in the output and if it appears more than once depends on the number of times it occurs across all inputs. In the following table, treat: * m: the number of time a records occurs in the primary input (p) * n1: the number of times a record occurs in the 1<sup>st</sup> secondary input (s1) * n2: the number of times a record occurs in the 2<sup>nd</sup> secondary input (s2) * &hellip; * n: the number of times a record occurs in the nth secondary input</p> <table> <thead> <tr> <th>Operation</th> <th>Description</th> <th>Examples</th> <th>Output Nullability</th> </tr> </thead> <tbody> <tr> <td>Minus (Primary)</td> <td>Returns all records from the primary input excluding any matching rows from secondary inputs, removing duplicates.<br>Each value is treated as a unique member of the set, so duplicates in the first set dont affect the result.<br>This operation maps to SQL EXCEPT DISTINCT.</td> <td>MINUS<br>&nbsp;&nbsp;p: {1, 2, 2, 3, 3, 3, 4}<br>&nbsp;&nbsp;s1: {1, 2}<br>&nbsp;&nbsp;s2: {3}<br>YIELDS<br>{4}</td> <td>The same as the primary input.</td> </tr> <tr> <td>Minus (Primary All)</td> <td>Returns all records from the primary input excluding any matching records from secondary inputs.<br>For each specific record returned, the output contains max(0, m - sum(n1, n2, , n)) copies.<br>This operation maps to SQL EXCEPT ALL.</td> <td>MINUS ALL<br>&nbsp;&nbsp;p: {1, 2, 2, 3, 3, 3, 3}<br>&nbsp;&nbsp;s1: {1, 2, 3, 4}<br>&nbsp;&nbsp;s2: {3}<br>YIELDS<br>{2, 3, 3}</td> <td>The same as the primary input.</td> </tr> <tr> <td>Minus (Multiset)</td> <td>Returns all records from the primary input excluding any records that are included in <em>all</em> secondary inputs.<br>This operation does not have a direct SQL mapping.</td> <td>MINUS MULTISET<br>&nbsp;&nbsp;p: {1, 2, 3, 4}<br>&nbsp;&nbsp;s1: {1, 2}<br>&nbsp;&nbsp;s2: {1, 2, 3}<br>YIELDS<br>{3, 4}</td> <td>The same as the primary input.</td> </tr> <tr> <td>Intersection (Primary)</td> <td>Returns all records from the primary input that are present in any secondary input, removing duplicates.<br>This operation does not have a direct SQL mapping.</td> <td>INTERSECT<br>&nbsp;&nbsp;p: {1, 2, 2, 3, 3, 3, 4}<br>&nbsp;&nbsp;s1: {1, 2, 3, 5}<br>&nbsp;&nbsp;s2: {2, 3, 6}<br>YIELDS<br>{1, 2, 3}</td> <td>If a field is nullable in the primary input and in any of the secondary inputs, it is nullable in the output.</td> </tr> <tr> <td>Intersection (Multiset)</td> <td>Returns all records from the primary input that match at least one record from <em>all</em> secondary inputs.<br>This operation maps to SQL INTERSECT DISTINCT</td> <td>INTERSECT MULTISET<br>&nbsp;&nbsp;p: {1, 2, 3, 4}<br>&nbsp;&nbsp;s1: {2, 3}<br>&nbsp;&nbsp;s2: {3, 4}<br>YIELDS<br>{3}</td> <td>If a field is required in any of the inputs, it is required in the output.</td> </tr> <tr> <td>Intersection (Multiset All)</td> <td>Returns all records from the primary input that are present in every secondary input.<br>For each specific record returned, the output contains min(m, n1, n2, , n) copies.<br>This operation maps to SQL INTERSECT ALL.</td> <td>INTERSECT ALL<br>&nbsp;&nbsp;p: {1, 2, 2, 3, 3, 3, 4}<br>&nbsp;&nbsp;s1: {1, 2, 3, 3, 5}<br>&nbsp;&nbsp;s2: {2, 3, 3, 6}<br>YIELDS<br>{2, 3, 3}</td> <td>If a field is required in any of the inputs, it is required in the output.</td> </tr> <tr> <td>Union Distinct</td> <td>Returns all records from each set, removing duplicates.<br>This operation maps to SQL UNION DISTINCT.</td> <td>UNION<br>&nbsp;&nbsp;p: {1, 2, 2, 3, 3, 3, 4}<br>&nbsp;&nbsp;s1: {2, 3, 5}<br>&nbsp;&nbsp;s2: {1, 6}<br>YIELDS<br>{1, 2, 3, 4, 5, 6}</td> <td>If a field is nullable in any of the inputs, it is nullable in the output.</td> </tr> <tr> <td>Union All</td> <td>Returns all records from all inputs.<br>For each specific record returned, the output contains (m + n1 + n2 +  + n) copies.<br>This operation maps to SQL UNION ALL.</td> <td>UNION ALL<br>&nbsp;&nbsp;p: {1, 2, 2, 3, 3, 3, 4}<br>&nbsp;&nbsp;s1: {2, 3, 5}<br>&nbsp;&nbsp;s2: {1, 6}<br>YIELDS<br>{1, 2, 2, 3, 3, 3, 4, 2, 3, 5, 1, 6}</td> <td>If a field is nullable in any of the inputs, it is nullable in the output.</td> </tr> </tbody> </table> <p>Note that for set operations, NULL matches NULL. That is <div class=highlight><pre><span></span><code>{NULL, 1, 3} MINUS          {NULL, 2, 4} === (1), (3)
{NULL, 1, 3} INTERSECTION   {NULL, 2, 3} === (NULL)
{NULL, 1, 3} UNION DISTINCT {NULL, 2, 4} === (NULL), (1), (2), (3), (4)
</code></pre></div></p> <h4 id=output-type-derivation-examples>Output Type Derivation Examples<a class=headerlink href=#output-type-derivation-examples title="Permanent link">&para;</a></h4> <p>Given the following inputs, where R is Required and N is Nullable: <div class=highlight><pre><span></span><code>Input 1: (R, R, R, R, N, N, N, N)  Primary Input
Input 2: (R, R, N, N, R, R, N, N)  Secondary Input
Input 3: (R, N, R, N, R, N, R, N)  Secondary Input
</code></pre></div></p> <p>The output type is as follows for the various operations</p> <table> <thead> <tr> <th>Property</th> <th>Output Type</th> </tr> </thead> <tbody> <tr> <td>Minus (Primary)</td> <td>(R, R, R, R, N, N, N, N)</td> </tr> <tr> <td>Minus (Primary All)</td> <td>(R, R, R, R, N, N, N, N)</td> </tr> <tr> <td>Minus (Multiset)</td> <td>(R, R, R, R, N, N, N, N)</td> </tr> <tr> <td>Intersection (Primary)</td> <td>(R, R, R, R, R, N, N, N)</td> </tr> <tr> <td>Intersection (Multiset)</td> <td>(R, R, R, R, R, R, R, N)</td> </tr> <tr> <td>Intersection (Multiset All)</td> <td>(R, R, R, R, R, R, R, N)</td> </tr> <tr> <td>Union Distinct</td> <td>(R, N, N, N, N, N, N, N)</td> </tr> <tr> <td>Union All</td> <td>(R, N, N, N, N, N, N, N)</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=7:1><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><div class=tabbed-labels><label for=__tabbed_7_1>SetRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>SetRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>  </span><span class=c1>// The first input is the primary input, the remaining are secondary</span>
<span class=w>  </span><span class=c1>// inputs.  There must be at least two inputs.</span>
<span class=w>  </span><span class=k>repeated</span><span class=w> </span><span class=n>Rel</span><span class=w> </span><span class=na>inputs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=n>SetOp</span><span class=w> </span><span class=na>op</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>

<span class=w>  </span><span class=kd>enum</span><span class=w> </span><span class=n>SetOp</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=na>SET_OP_UNSPECIFIED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=na>SET_OP_MINUS_PRIMARY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=na>SET_OP_MINUS_PRIMARY_ALL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>7</span><span class=p>;</span>
<span class=w>    </span><span class=na>SET_OP_MINUS_MULTISET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>    </span><span class=na>SET_OP_INTERSECTION_PRIMARY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>    </span><span class=na>SET_OP_INTERSECTION_MULTISET</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>
<span class=w>    </span><span class=na>SET_OP_INTERSECTION_MULTISET_ALL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>8</span><span class=p>;</span>
<span class=w>    </span><span class=na>SET_OP_UNION_DISTINCT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>
<span class=w>    </span><span class=na>SET_OP_UNION_ALL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>6</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h2 id=fetch-operation>Fetch Operation<a class=headerlink href=#fetch-operation title="Permanent link">&para;</a></h2> <p>The fetch operation eliminates records outside a desired window. Typically corresponds to a fetch/offset SQL clause. Will only returns records between the start offset and the end offset.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>1</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Maintains distribution and orderedness.</td> </tr> <tr> <td>Direct Output Order</td> <td>Unchanged from input.</td> </tr> </tbody> </table> <h3 id=fetch-properties>Fetch Properties<a class=headerlink href=#fetch-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Input</td> <td>A relational input, typically with a desired orderedness property.</td> <td>Required</td> </tr> <tr> <td>Offset Expression</td> <td>An expression which evaluates to a non-negative integer or null (recommended type is <code>i64</code>). Declares the offset for retrieval of records. An expression evaluating to null is treated as 0.</td> <td>Optional, defaults to a 0 literal.</td> </tr> <tr> <td>Count Expression</td> <td>An expression which evaluates to a non-negative integer or null (recommended type is <code>i64</code>). Declares the number of records that should be returned. An expression evaluating to null indicates that all records should be returned.</td> <td>Optional, defaults to a null literal.</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=8:1><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><div class=tabbed-labels><label for=__tabbed_8_1>FetchRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>FetchRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=c1>// Note: A oneof field is inherently optional, whereas individual fields</span>
<span class=w>  </span><span class=c1>// within a oneof cannot be marked as optional. The unset state of offset</span>
<span class=w>  </span><span class=c1>// should therefore be checked at the oneof level. Unset is treated as 0.</span>
<span class=w>  </span><span class=k>oneof</span><span class=w> </span><span class=n>offset_mode</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// the offset expressed in number of records</span>
<span class=w>    </span><span class=c1>// Deprecated: use `offset_expr` instead</span>
<span class=w>    </span><span class=kt>int64</span><span class=w> </span><span class=na>offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=p>[</span><span class=na>deprecated</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>];</span>
<span class=w>    </span><span class=c1>// Expression evaluated into a non-negative integer specifying the number</span>
<span class=w>    </span><span class=c1>// of records to skip. An expression evaluating to null is treated as 0.</span>
<span class=w>    </span><span class=c1>// Evaluating to a negative integer should result in an error.</span>
<span class=w>    </span><span class=c1>// Recommended type for offset is int64.</span>
<span class=w>    </span><span class=n>Expression</span><span class=w> </span><span class=na>offset_expr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=c1>// Note: A oneof field is inherently optional, whereas individual fields</span>
<span class=w>  </span><span class=c1>// within a oneof cannot be marked as optional. The unset state of count</span>
<span class=w>  </span><span class=c1>// should therefore be checked at the oneof level. Unset is treated as ALL.</span>
<span class=w>  </span><span class=k>oneof</span><span class=w> </span><span class=n>count_mode</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// the amount of records to return</span>
<span class=w>    </span><span class=c1>// use -1 to signal that ALL records should be returned</span>
<span class=w>    </span><span class=c1>// Deprecated: use `count_expr` instead</span>
<span class=w>    </span><span class=kt>int64</span><span class=w> </span><span class=na>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=w> </span><span class=p>[</span><span class=na>deprecated</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>];</span>
<span class=w>    </span><span class=c1>// Expression evaluated into a non-negative integer specifying the number</span>
<span class=w>    </span><span class=c1>// of records to return. An expression evaluating to null signals that ALL</span>
<span class=w>    </span><span class=c1>// records should be returned.</span>
<span class=w>    </span><span class=c1>// Evaluating to a negative integer should result in an error.</span>
<span class=w>    </span><span class=c1>// Recommended type for count is int64.</span>
<span class=w>    </span><span class=n>Expression</span><span class=w> </span><span class=na>count_expr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>6</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h2 id=aggregate-operation>Aggregate Operation<a class=headerlink href=#aggregate-operation title="Permanent link">&para;</a></h2> <p>The aggregate operation groups input data on one or more sets of grouping keys, calculating each measure for each combination of grouping key.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>1</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Maintains distribution if all distribution fields are contained in every grouping set. No orderedness guaranteed.</td> </tr> <tr> <td>Direct Output Order</td> <td>The list of grouping expressions in declaration order followed by the list of measures in declaration order, followed by an <code>i32</code> describing the associated particular grouping set the value is derived from (if applicable).</td> </tr> </tbody> </table> <p>In its simplest form, an aggregation has only measures. In this case, all records are folded into one, and a column is returned for each aggregate expression in the measures list.</p> <p>Grouping sets can be used for finer-grained control over which records are folded. A grouping set consists of zero or more references to the list of grouping expressions. Within a grouping set, two records will be folded together if and only if they have the same values for each of the expressions in the grouping set. The values returned by the grouping expressions will be returned as columns to the left of the columns for the aggregate expressions. Each of the grouping expressions must occur in at least one of the grouping sets. If a grouping set contains no grouping expressions, all rows will be folded for that grouping set. (Having a single grouping set with no grouping expressions is thus equivalent to not having any grouping sets.)</p> <p>It is possible to specify multiple grouping sets in a single aggregate operation. The grouping sets behave more or less independently, with each returned record belonging to one of the grouping sets. The values for the grouping expression columns that are not part of the grouping set for a particular record will be set to null. The columns for grouping expressions that do <em>not</em> appear in <em>all</em> grouping sets will be nullable (regardless of the nullability of the type returned by the grouping expression) to accomodate the null insertion.</p> <p>To further disambiguate which record belongs to which grouping set, an aggregate relation with more than one grouping set receives an extra <code>i32</code> column on the right-hand side. The value of this field will be the zero-based index of the grouping set that yielded the record.</p> <p>If at least one grouping expression is present, the aggregation is allowed to not have any aggregate expressions. An aggregate relation is invalid if it would yield zero columns.</p> <h3 id=aggregate-properties>Aggregate Properties<a class=headerlink href=#aggregate-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Input</td> <td>The relational input.</td> <td>Required</td> </tr> <tr> <td>Grouping Sets</td> <td>One or more grouping sets.</td> <td>Optional, required if no measures.</td> </tr> <tr> <td>Per Grouping Set</td> <td>A list of expression grouping that the aggregation measured should be calculated for.</td> <td>Optional.</td> </tr> <tr> <td>Measures</td> <td>A list of one or more aggregate expressions along with an optional filter.</td> <td>Optional, required if no grouping sets.</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=9:1><input checked=checked id=__tabbed_9_1 name=__tabbed_9 type=radio><div class=tabbed-labels><label for=__tabbed_9_1>AggregateRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>AggregateRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// Input of the aggregation</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// A list of zero or more grouping sets that the aggregation measures should</span>
<span class=w>  </span><span class=c1>// be calculated for. There must be at least one grouping set if there are no</span>
<span class=w>  </span><span class=c1>// measures (but it can be the empty grouping set).</span>
<span class=w>  </span><span class=k>repeated</span><span class=w> </span><span class=n>Grouping</span><span class=w> </span><span class=na>groupings</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// A list of one or more aggregate expressions along with an optional filter.</span>
<span class=w>  </span><span class=c1>// Required if there are no groupings.</span>
<span class=w>  </span><span class=k>repeated</span><span class=w> </span><span class=n>Measure</span><span class=w> </span><span class=na>measures</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// A list of zero or more grouping expressions that grouping sets (i.e.,</span>
<span class=w>  </span><span class=c1>// `Grouping` messages in the `groupings` field) can reference. Each</span>
<span class=w>  </span><span class=c1>// expression in this list must be referred to by at least one</span>
<span class=w>  </span><span class=c1>// `Grouping.expression_references`.</span>
<span class=w>  </span><span class=k>repeated</span><span class=w> </span><span class=n>Expression</span><span class=w> </span><span class=na>grouping_expressions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>

<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>

<span class=w>  </span><span class=kd>message</span><span class=w> </span><span class=nc>Grouping</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// Deprecated in favor of `expression_references` below.</span>
<span class=w>    </span><span class=k>repeated</span><span class=w> </span><span class=n>Expression</span><span class=w> </span><span class=na>grouping_expressions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>[</span><span class=na>deprecated</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>];</span>

<span class=w>    </span><span class=c1>// A list of zero or more references to grouping expressions, i.e., indices</span>
<span class=w>    </span><span class=c1>// into the `grouping_expression` list.</span>
<span class=w>    </span><span class=k>repeated</span><span class=w> </span><span class=kt>uint32</span><span class=w> </span><span class=na>expression_references</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=kd>message</span><span class=w> </span><span class=nc>Measure</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>AggregateFunction</span><span class=w> </span><span class=na>measure</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>

<span class=w>    </span><span class=c1>// An optional boolean expression that acts to filter which records are</span>
<span class=w>    </span><span class=c1>// included in the measure. True means include this record for calculation</span>
<span class=w>    </span><span class=c1>// within the measure.</span>
<span class=w>    </span><span class=c1>// Helps to support SUM(&lt;c&gt;) FILTER(WHERE...) syntax without masking opportunities for optimization</span>
<span class=w>    </span><span class=n>Expression</span><span class=w> </span><span class=na>filter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h2 id=reference-operator>Reference Operator<a class=headerlink href=#reference-operator title="Permanent link">&para;</a></h2> <p>The reference operator is used to construct DAGs of operations. In a <code>Plan</code> we can have multiple Rel representing various computations with potentially multiple outputs. The <code>ReferenceRel</code> is used to express the fact that multiple <code>Rel</code> might be sharing subtrees of computation. This can be used to express arbitrary DAGs as well as represent multi-query optimizations.</p> <p>As a concrete example think about two queries <code>SELECT * FROM A JOIN B JOIN C</code> and <code>SELECT * FROM A JOIN B JOIN D</code>, We could use the <code>ReferenceRel</code> to highlight the shared <code>A JOIN B</code> between the two queries, by creating a plan with 3 <code>Rel</code>. One expressing <code>A JOIN B</code> (in position 0 in the plan), one using reference as follows: <code>ReferenceRel(0) JOIN C</code> and a third one doing <code>ReferenceRel(0) JOIN D</code>. This allows to avoid the redundancy of <code>A JOIN B</code>.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>1</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Maintains all properties of the input</td> </tr> <tr> <td>Direct Output Order</td> <td>Maintains order</td> </tr> </tbody> </table> <h3 id=reference-properties>Reference Properties<a class=headerlink href=#reference-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Referred Rel</td> <td>A zero-indexed positional reference to a <code>Rel</code> defined within the same <code>Plan</code>.</td> <td>Required</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=10:1><input checked=checked id=__tabbed_10_1 name=__tabbed_10 type=radio><div class=tabbed-labels><label for=__tabbed_10_1>ReferenceRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>ReferenceRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kt>int32</span><span class=w> </span><span class=na>subtree_ordinal</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h2 id=write-operator>Write Operator<a class=headerlink href=#write-operator title="Permanent link">&para;</a></h2> <p>The write operator is an operator that consumes one input and writes it to storage. This can range from writing to a Parquet file, to INSERT/DELETE/UPDATE in a database.</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>1</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Output depends on OutputMode (none, or modified records)</td> </tr> <tr> <td>Direct Output Order</td> <td>Unchanged from input</td> </tr> </tbody> </table> <h3 id=write-properties>Write Properties<a class=headerlink href=#write-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Write Type</td> <td>Definition of which object we are operating on (e.g., a fully-qualified table name).</td> <td>Required</td> </tr> <tr> <td>CTAS Schema</td> <td>The names of all the columns and their type for a CREATE TABLE AS.</td> <td>Required only for CTAS</td> </tr> <tr> <td>Write Operator</td> <td>Which type of operation we are performing (INSERT/DELETE/UPDATE/CTAS).</td> <td>Required</td> </tr> <tr> <td>Rel Input</td> <td>The Rel representing which records we will be operating on (e.g., VALUES for an INSERT, or which records to DELETE, or records and after-image of their values for UPDATE).</td> <td>Required</td> </tr> <tr> <td>Create Mode</td> <td>This determines what should happen if the table already exists (ERROR/REPLACE/IGNORE)</td> <td>Required only for CTAS</td> </tr> <tr> <td>Output Mode</td> <td>For views that modify a DB it is important to control which records to &ldquo;return&rdquo;. Common default is NO_OUTPUT where we return nothing. Alternatively, we can return MODIFIED_RECORDS, that can be further manipulated by layering more rels ontop of this WriteRel (e.g., to &ldquo;count how many records were updated&rdquo;). This also allows to return the after-image of the change. To return before-image (or both) one can use the reference mechanisms and have multiple return values.</td> <td>Required for VIEW CREATE/CREATE_OR_REPLACE/ALTER</td> </tr> </tbody> </table> <h3 id=write-definition-types>Write Definition Types<a class=headerlink href=#write-definition-types title="Permanent link">&para;</a></h3> <details class="info inline end" open=open> <summary>Adding new Write Definition Types</summary> <p>If you have a write definition that&rsquo;s not covered here, see the <a href=../../spec/extending/ >process for adding new write definition types</a>.</p> </details> <p>Write definition types are built by the community and added to the specification.</p> <div class="tabbed-set tabbed-alternate" data-tabs=11:1><input checked=checked id=__tabbed_11_1 name=__tabbed_11 type=radio><div class=tabbed-labels><label for=__tabbed_11_1>WriteRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>WriteRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=c1>// Definition of which TABLE we are operating on</span>
<span class=w>  </span><span class=k>oneof</span><span class=w> </span><span class=n>write_type</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>NamedObjectWrite</span><span class=w> </span><span class=na>named_table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=n>ExtensionObject</span><span class=w> </span><span class=na>extension_table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// The schema of the table (must align with Rel input (e.g., number of leaf fields must match))</span>
<span class=w>  </span><span class=n>NamedStruct</span><span class=w> </span><span class=na>table_schema</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// The type of operation to perform</span>
<span class=w>  </span><span class=n>WriteOp</span><span class=w> </span><span class=na>op</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// The relation that determines the records to add/remove/modify</span>
<span class=w>  </span><span class=c1>// the schema must match with table_schema. Default values must be explicitly stated</span>
<span class=w>  </span><span class=c1>// in a ProjectRel at the top of the input. The match must also</span>
<span class=w>  </span><span class=c1>// occur in case of DELETE to ensure multi-engine plans are unequivocal.</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>

<span class=w>  </span><span class=n>CreateMode</span><span class=w> </span><span class=na>create_mode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>8</span><span class=p>;</span><span class=w> </span><span class=c1>// Used with CTAS to determine what to do if the table already exists</span>

<span class=w>  </span><span class=c1>// Output mode determines what is the output of executing this rel</span>
<span class=w>  </span><span class=n>OutputMode</span><span class=w> </span><span class=na>output</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>6</span><span class=p>;</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>7</span><span class=p>;</span>

<span class=w>  </span><span class=kd>enum</span><span class=w> </span><span class=n>WriteOp</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=na>WRITE_OP_UNSPECIFIED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// The insert of new records in a table</span>
<span class=w>    </span><span class=na>WRITE_OP_INSERT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// The removal of records from a table</span>
<span class=w>    </span><span class=na>WRITE_OP_DELETE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// The modification of existing records within a table</span>
<span class=w>    </span><span class=na>WRITE_OP_UPDATE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// The Creation of a new table, and the insert of new records in the table</span>
<span class=w>    </span><span class=na>WRITE_OP_CTAS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=kd>enum</span><span class=w> </span><span class=n>CreateMode</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=na>CREATE_MODE_UNSPECIFIED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=na>CREATE_MODE_APPEND_IF_EXISTS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=c1>// Append the data to the table if it already exists</span>
<span class=w>    </span><span class=na>CREATE_MODE_REPLACE_IF_EXISTS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w> </span><span class=c1>// Replace the table if it already exists (&quot;OR REPLACE&quot;)</span>
<span class=w>    </span><span class=na>CREATE_MODE_IGNORE_IF_EXISTS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span><span class=w> </span><span class=c1>// Ignore the request if the table already exists (&quot;IF NOT EXISTS&quot;)</span>
<span class=w>    </span><span class=na>CREATE_MODE_ERROR_IF_EXISTS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span><span class=w> </span><span class=c1>// Throw an error if the table already exists (default behavior)</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=kd>enum</span><span class=w> </span><span class=n>OutputMode</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=na>OUTPUT_MODE_UNSPECIFIED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// return no records at all</span>
<span class=w>    </span><span class=na>OUTPUT_MODE_NO_OUTPUT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// this mode makes the operator return all the record INSERTED/DELETED/UPDATED by the operator.</span>
<span class=w>    </span><span class=c1>// The operator returns the AFTER-image of any change. This can be further manipulated by operators upstreams</span>
<span class=w>    </span><span class=c1>// (e.g., retunring the typical &quot;count of modified records&quot;).</span>
<span class=w>    </span><span class=c1>// For scenarios in which the BEFORE image is required, the user must implement a spool (via references to</span>
<span class=w>    </span><span class=c1>// subplans in the body of the Rel input) and return those with anounter PlanRel.relations.</span>
<span class=w>    </span><span class=na>OUTPUT_MODE_MODIFIED_RECORDS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>9</span><span class=p>;</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h4 id=virtual-table_1>Virtual Table<a class=headerlink href=#virtual-table_1 title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Name</td> <td>The in-memory name to give the dataset.</td> <td>Required</td> </tr> <tr> <td>Pin</td> <td>Whether it is okay to remove this dataset from memory or it should be kept in memory.</td> <td>Optional, defaults to false.</td> </tr> </tbody> </table> <h4 id=files-type_1>Files Type<a class=headerlink href=#files-type_1 title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Path</td> <td>A URI to write the data to. Supports the inclusion of field references that are listed as available in properties as a &ldquo;rotation description field&rdquo;.</td> <td>Required</td> </tr> <tr> <td>Format</td> <td>Enumeration of available formats. Only current option is PARQUET.</td> <td>Required</td> </tr> </tbody> </table> <h2 id=update-operator>Update Operator<a class=headerlink href=#update-operator title="Permanent link">&para;</a></h2> <p>The update operator applies a set of column transformations on a named table and writes to a storage. </p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>0</td> </tr> <tr> <td>Outputs</td> <td>1</td> </tr> <tr> <td>Property Maintenance</td> <td>Output is number of modified records</td> </tr> </tbody> </table> <h3 id=update-properties>Update Properties<a class=headerlink href=#update-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Update Type</td> <td>Definition of which object we are operating on (e.g., a fully-qualified table name).</td> <td>Required</td> </tr> <tr> <td>Table Schema</td> <td>The names and types of all the columns of the input table</td> <td>Required</td> </tr> <tr> <td>Update Condition</td> <td>The condition that must be met for a record to be updated.</td> <td>Required</td> </tr> <tr> <td>Update Transformations</td> <td>The set of column updates to be applied to the table.</td> <td>Required</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=12:1><input checked=checked id=__tabbed_12_1 name=__tabbed_12 type=radio><div class=tabbed-labels><label for=__tabbed_12_1>UpdateRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>UpdateRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=k>oneof</span><span class=w> </span><span class=n>update_type</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>NamedTable</span><span class=w> </span><span class=na>named_table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=n>NamedStruct</span><span class=w> </span><span class=na>table_schema</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w> </span><span class=c1>// The full schema of the named_table</span>
<span class=w>  </span><span class=n>Expression</span><span class=w> </span><span class=na>condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span><span class=w> </span><span class=c1>// condition to be met for the update to be applied on a record</span>

<span class=w>  </span><span class=c1>// The list of transformations to apply to the columns of the named_table</span>
<span class=w>  </span><span class=k>repeated</span><span class=w> </span><span class=n>TransformExpression</span><span class=w> </span><span class=na>transformations</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>

<span class=w>  </span><span class=kd>message</span><span class=w> </span><span class=nc>TransformExpression</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>Expression</span><span class=w> </span><span class=na>transformation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=c1>// the transformation to apply</span>
<span class=w>    </span><span class=kt>int32</span><span class=w> </span><span class=na>column_target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w> </span><span class=c1>// index of the column to apply the transformation to</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <h2 id=ddl-data-definition-language-operator>DDL (Data Definition Language) Operator<a class=headerlink href=#ddl-data-definition-language-operator title="Permanent link">&para;</a></h2> <p>The operator that defines modifications of a database schema (CREATE/DROP/ALTER for TABLE and VIEWS).</p> <table> <thead> <tr> <th>Signature</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Inputs</td> <td>1</td> </tr> <tr> <td>Outputs</td> <td>0</td> </tr> <tr> <td>Property Maintenance</td> <td>N/A (no output)</td> </tr> <tr> <td>Direct Output Order</td> <td>N/A</td> </tr> </tbody> </table> <h3 id=ddl-properties>DDL Properties<a class=headerlink href=#ddl-properties title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Property</th> <th>Description</th> <th>Required</th> </tr> </thead> <tbody> <tr> <td>Write Type</td> <td>Definition of which type of object we are operating on.</td> <td>Required</td> </tr> <tr> <td>Table Schema</td> <td>The names of all the columns and their type.</td> <td>Required (except for DROP operations)</td> </tr> <tr> <td>Table Defaults</td> <td>The set of default values for this table.</td> <td>Required (except for DROP operations)</td> </tr> <tr> <td>DDL Object</td> <td>Which type of object we are operating on (e.g., TABLE or VIEW).</td> <td>Required</td> </tr> <tr> <td>DDL Operator</td> <td>The operation to be performed (e.g., CREATE/ALTER/DROP).</td> <td>Required</td> </tr> <tr> <td>View Definition</td> <td>A Rel representing the &ldquo;body&rdquo; of a VIEW.</td> <td>Required for VIEW CREATE/CREATE_OR_REPLACE/ALTER</td> </tr> </tbody> </table> <div class="tabbed-set tabbed-alternate" data-tabs=13:1><input checked=checked id=__tabbed_13_1 name=__tabbed_13 type=radio><div class=tabbed-labels><label for=__tabbed_13_1>DdlRel Message</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>message</span><span class=w> </span><span class=nc>DdlRel</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=c1>// Definition of which type of object we are operating on</span>
<span class=w>  </span><span class=k>oneof</span><span class=w> </span><span class=n>write_type</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>NamedObjectWrite</span><span class=w> </span><span class=na>named_object</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=n>ExtensionObject</span><span class=w> </span><span class=na>extension_object</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=c1>// The columns that will be modified (representing after-image of a schema change)</span>
<span class=w>  </span><span class=n>NamedStruct</span><span class=w> </span><span class=na>table_schema</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>  </span><span class=c1>// The default values for the columns (representing after-image of a schema change)</span>
<span class=w>  </span><span class=c1>// E.g., in case of an ALTER TABLE that changes some of the column default values, we expect</span>
<span class=w>  </span><span class=c1>// the table_defaults Struct to report a full list of default values reflecting the result of applying</span>
<span class=w>  </span><span class=c1>// the ALTER TABLE operator successfully</span>
<span class=w>  </span><span class=n>Expression.Literal.Struct</span><span class=w> </span><span class=na>table_defaults</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// Which type of object we operate on</span>
<span class=w>  </span><span class=n>DdlObject</span><span class=w> </span><span class=na>object</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// The type of operation to perform</span>
<span class=w>  </span><span class=n>DdlOp</span><span class=w> </span><span class=na>op</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>6</span><span class=p>;</span>

<span class=w>  </span><span class=c1>// The body of the CREATE VIEW</span>
<span class=w>  </span><span class=n>Rel</span><span class=w> </span><span class=na>view_definition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>7</span><span class=p>;</span>
<span class=w>  </span><span class=n>RelCommon</span><span class=w> </span><span class=na>common</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>8</span><span class=p>;</span>

<span class=w>  </span><span class=kd>enum</span><span class=w> </span><span class=n>DdlObject</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=na>DDL_OBJECT_UNSPECIFIED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// A Table object in the system</span>
<span class=w>    </span><span class=na>DDL_OBJECT_TABLE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// A View object in the system</span>
<span class=w>    </span><span class=na>DDL_OBJECT_VIEW</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=kd>enum</span><span class=w> </span><span class=n>DdlOp</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=na>DDL_OP_UNSPECIFIED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// A create operation (for any object)</span>
<span class=w>    </span><span class=na>DDL_OP_CREATE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// A create operation if the object does not exist, or replaces it (equivalent to a DROP + CREATE) if the object already exists</span>
<span class=w>    </span><span class=na>DDL_OP_CREATE_OR_REPLACE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// An operation that modifies the schema (e.g., column names, types, default values) for the target object</span>
<span class=w>    </span><span class=na>DDL_OP_ALTER</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// An operation that removes an object from the system</span>
<span class=w>    </span><span class=na>DDL_OP_DROP</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// An operation that removes an object from the system (without throwing an exception if the object did not exist)</span>
<span class=w>    </span><span class=na>DDL_OP_DROP_IF_EXIST</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=n>substrait.extensions.AdvancedExtension</span><span class=w> </span><span class=na>advanced_extension</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>9</span><span class=p>;</span>

<span class=w>  </span><span class=c1>//TODO add PK/constraints/indexes/etc..?</span>

<span class=p>}</span>
</code></pre></div> </div> </div> </div> <details class=question open=open> <summary>Discussion Points</summary> <ul> <li>How should correlated operations be handled?</li> </ul> </details> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Application footer --> <footer class=md-footer> <!-- Link to previous and/or next page --> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=footer.title> <!-- Link to previous page --> <a href=../common_fields/ title="Common Fields" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Common Fields </div> </div> </a> <!-- Link to next page --> <a href=../physical_relations/ title="Physical Relations" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Physical Relations </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> </div> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <!-- Copyright and theme information --> <div class=md-footer-copyright> </div> <!-- Social links --> <div class=md-social> <a href=https://twitter.com/substrait_io target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.instant", "toc.integrate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>